@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Teste Colorado CRUD</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
    <s@*cript src="../wwwroot/js/site.js"></script>*@
</head>
<body>
    <input type="hidden" id="Id" value="0" />
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <h2>Delete (DELETE) uma linha</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <table id="clienteTable"
                       class="table table-bordered table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Edit</th>
                            <th>Código Cliente</th>
                            <th>Nome</th>
                            <th>Endereço</th>
                            <th>Cidade</th>
                            <th>UF</th>
                            <th>DataCadastro</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <button type="button" id="addButton"
                        class="btn btn-primary"
                        onclick="addClick();">
                    Add Cliente
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        Cliente Information
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="introCodigoCliente">
                                Código Cliente
                            </label>
                            <input type="text" id="introCodigoCliente"
                                   class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="introNome">
                                Nome
                            </label>
                            <input type="text" id="introNome"
                                   class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="introEndereco">Endereço</label>
                            <input type="text" id="introEndereco"
                                   class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="introCidade">Cidade</label>
                            <input type="text" id="introCidade"
                                   class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="introUf">UF</label>
                            <input type="text" id="introUf"
                                   class="form-control" maxlength="2" />
                        </div>
                        <div class="form-group">
                            <label for="introDataCadastro">Data Cadastro</label>
                            <input type="text" id="introDataCadastro"
                                   class="form-control" />
                        </div>
                    </div>
                    <div class="panel-footer">
                        <div class="row">
                            <div class="col-xs-12">
                                <button type="button" id="updateButton"
                                        class="btn btn-primary"
                                        onclick="updateClick();">
                                    Add
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script>
	$(document).ready(function () {
		clienteList();
	});

	var Cliente = {
		Id: 0,
		CodigoCliente: "",
		Nome: "",
		Endereco: "",
		Cidade: "",
		UF: "",
		DataCadastro: ""
	}

	function updateClick() {
		// Build cliente object from inputs
		Cliente = new Object();
		Cliente.Id = $("#Id").val();
		Cliente.CodigoCliente = $("#CodigoCliente").val();
		Cliente.Nome = $("#Nome").val();
		Cliente.Endereco = $("#Endereco").val();
		Cliente.Cidade = $("#Cidade").val();
		Cliente.UF = $("#UF").val();
		Cliente.DataCadastro = $("#DataCadastro").val();

		if ($("#updateButton").text().trim() == "Add") {
			clienteAdd(Cliente);
		}
		else {
			clienteUpdate(Cliente);
		}
	}

	function addClick() {
		formClear();
	}

	function clienteUpdate(cliente) {
		var url = "https://localhost:5001/api/Cliente/UpdateAsunc";

		// Call Web API to update cliente
		$.ajax({
			url: url,
			type: 'POST',
			contentType: "application/json;charset=utf-8",
			data: JSON.stringify(cliente),
			success: function (cliente) {
				clienteUpdateSuccess(cliente);
			},
			error: function (request, message, error) {
				handleException(request, message, error);
			}
		});
	}

	function clienteUpdateSuccess(cliente) {
		clienteUpdateInTable(cliente);
	}

	function clienteAdd(cliente) {
		// Call Web API to add a new cliente
		$.ajax({
			url: "https://localhost:5001/api/Cliente/AddAsync",
			type: 'POST',
			contentType: "application/json;charset=utf-8",
			data: JSON.stringify(cliente),
			success: function (cliente) {
				clienteAddSuccess(cliente);
			},
			error: function (request, message, error) {
				handleException(request, message, error);
			}
		});
	}

	function clienteAddSuccess(cliente) {
		clienteAddRow(cliente);
		formClear();
	}

	// Update cliente in <table>
	function clienteUpdateInTable(cliente) {
		// Find Cliente in <table>
		var row = $("#clienteTable button[data-id='" + cliente.Id + "']")
			.parents("tr")[0];
		// Add changed cliente to table
		$(row).after(clienteBuildTableRow(cliente));
		// Remove original cliente
		$(row).remove();

		// Clear form fields
		formClear();

		// Change Update Button Text
		$("#updateButton").text("Add");
	}

	function clienteGet(ctl) {
		// Get cliente id from data- attribute
		var id = $(ctl).data("id");

		// Store cliente id in hidden field
		$("#clienteid").val(id);

		// Call Web API to get a Cliente
		$.ajax({
			url: "https://localhost:5001/api/Cliente/GetByIdAsync",
			type: 'POST',
			contentType: "application/json;charset=utf-8",
			data: JSON.stringify(id),
			success: function (id) {
				clienteToFields(cliente);

				// Change Update Button Text
				$("#updateButton").text("Update");
			},
			error: function (request, message, error) {
				handleException(request, message, error);
			}
		});
	}

	function clienteToFields(cliente) {
		$("#introCodigoCliente").val(cliente.CodigoCliente);
		$("#introNome").val(cliente.Nome);
		$("#introEndereco").val(cliente.Endereco);
		$("#introCidade").val(cliente.Cidade);
		$("#introUf").val(cliente.UF);
		$("#introDataCadastro").val(cliente.DataCadastro);
	}

	// Get all Clientes to display
	function clienteList() {
		// Call Web API to get a list of Clientes
		$.ajax({
			dataType: 'jsonp',
			async: true,
			await: true,
			"crossDomain": true,
			url: 'https://localhost:5001/api/Cliente/GetAllAsync/',
			type: 'GET',
			headers: {
				"Accept": "application/json",
				"Access-Control-Allow-Origin": "*"
			},
			success: function () {
				//clienteListSuccess(data);
				console.log(data);
			},
			error: function (request, message, error) {
				handleException(request, message, error);
			}
		});
	}

	// Display all Clientes returned from Web API call
	function clienteListSuccess(data) {
		// Iterate over the collection of data
		$.each(clientes, function (index, cliente) {
			// Add a row to the Cliente table
			clienteAddRow(cliente);
		});
	}

	// Add Cliente row to <table>
	function clienteAddRow(cliente) {
		// First check if a <tbody> tag exists, add one if not
		if ($("#clienteTable tbody").length == 0) {
			$("#clienteTable").append("<tbody></tbody>");
		}

		// Append row to <table>
		$("#clienteTable tbody").append(
			clienteBuildTableRow(cliente));
	}

	// Build a <tr> for a row of table data
	function clienteBuildTableRow(cliente) {
		var ret = "<tr>" +
			"<td>" +
			"<button type='button' " +
			"onclick='clienteGet(this);' " +
			"class='btn btn-default' " +
			"data-id='" + cliente.Id + "'>" +
			"<span class='glyphicon glyphicon-edit' />" +
			"</button>" +
			"</td>" +
			"<td>" + cliente.CodigoCliente + "</td>" +
			"<td>" + cliente.Nome + "</td>" +
			"<td>" + cliente.Endereco + "</td>" +
			"<td>" + cliente.Cidade + "</td>" +
			"<td>" + cliente.UF + "</td>" +
			"<td>" + cliente.DataCadastro + "</td>" +
			"<td>" +
			"<button type='button' " +
			"onclick='clienteDelete(this);' " +
			"class='btn btn-default' " +
			"data-id='" + cliente.Id + "'>" +
			"<span class='glyphicon glyphicon-remove' />" +
			"</button>" +
			"</td>" +
			"</tr>";

		return ret;
	}

	// Delete cliente from <table>
	function clienteDelete(id) {
		// Call Web API to delete a new cliente
		$.ajax({
			url: "https://localhost:5001/api/Cliente/DeleteAsync",
			type: 'POST',
			contentType: "application/json;charset=utf-8",
			data: JSON.stringify(id),
			success: function (id) {
				clienteAddSuccess(id);
			},
			error: function (request, message, error) {
				handleException(request, message, error);
			}
		});
	}

	// Clear form fields
	function formClear() {
		$("#introCodigoCliente").val();
		$("#introNome").val();
		$("#introEndereco").val();
		$("#introCidade").val();
		$("#introUf").val();
		$("#introDataCadastro").val();
	}

	// Handle exceptions from AJAX calls
	function handleException(request, message, error) {
		var msg = "";
		msg += "Code: " + request.status + "\n";
		msg += "Text: " + request.statusText + "\n";
		if (request.responseJSON != null) {
			msg += "Message" + request.responseJSON.Message + "\n";
		}

		//alert(msg);
	}

</script>


